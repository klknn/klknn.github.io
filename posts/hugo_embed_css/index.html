<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>HugoにおけるCSSの埋め込みと後処理</title><style>@media(prefers-color-scheme:dark){body{background-color:#222;color:#ddd}a:link{color:#88c}a:visited{color:#bbc}a:hover{color:#f88}a:active{color:#f80}}h1,h2,h3,h4,h5,h6{margin:2rem auto 1rem;max-width:50rem}.toc{max-width:45rem;padding:1rem;border:dotted}p,.highlight,.gist-file,figure,div,hr{margin:1rem auto;max-width:50rem;width:90%}blockquote{margin:1rem auto;max-width:45rem;font-style:italic;border-left:solid 5px}ul,li{margin:.75rem auto;max-width:50rem}img{width:100%}table,th,td{border-collapse:collapse;border:1px solid;line-height:1.5;padding:10px;border-left:none;border-right:none;margin:1rem auto;max-width:50rem}figcaption{text-align:center;font-style:italic}.index-date{text-align:right;font-style:italic}pre{overflow:scroll}</style><script>MathJax={tex:{tags:"ams",inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js></script></head><body><a href=/>klknn log</a> /
<a href=/posts/>posts</a> /
<a href=/tags/>tags</a> /
<a href=/about/>about</a> /
<a href=/index.xml>feed</a><h1>HugoにおけるCSSの埋め込みと後処理</h1><ul>date: 2022-08-26 04:55:30 +0900 <a href=https://github.com/klknn/klknn.github.io/edit/develop/content/posts/hugo_embed_css.md>edit</a></ul><ul>tags: <a href=/tags/hugo/>hugo</a></ul><div class=toc>Table of contents<nav id=TableOfContents><ul><li><a href=#これまでの問題>これまでの問題</a></li><li><a href=#scssの読み込み>SCSSの読み込み</a></li><li><a href=#まとめ>まとめ</a></li></ul></nav></div><p>CSSを試行錯誤中なのですがブラウザのキャッシュが効いて反映されないため面倒だなと思い、Hugo の asset 管理を使ってHTMLに埋め込んでみました。
おまけに最小化やSCSSの導入など、思わぬ副次効果もありました。</p><h2 id=これまでの問題>これまでの問題</h2><p>ここ最近の更新では、たびたびCSSを弄っていました。これまでは元ファイルを <code>/static/main.css</code> に置いてそのまま直接リンクを貼っていたのですが、リンクを介すことでブラウザのキャッシュが効いてしまい、 <code>$ hugo serve</code> をしているとき即座に反映されない悩みがありました。</p><p>ついでに生のCSSって冗長で人間が書くものでは無いな&mldr;と思っていたのでどうせHugoを使って処理するなら&mldr;とSASS/SCSSに移行していきます。</p><p>一方、埋め込むことで読み込みに時間がかかるのではという懸念もありますが、後処理がてら<code>hugo --minify</code>で最小化できます。これで普段は人間に読める形で試行錯誤できる上に、デプロイ時は最小化してるので良いところどりです。
最終的に埋め込みが問題になれば <code>.RelURL</code> によるリンク生成も可能なのでキャッシュ効く形に戻すのも容易です。</p><h2 id=scssの読み込み>SCSSの読み込み</h2><p>というわけでHugoのasset管理を使って、HTMLに直接埋め込みます。 <code>/assets/main.scss</code> にファイルを移動した上で、このように読み込みます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span>    {{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>css</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>Get</span> <span style=color:#e6db74>&#34;main.scss&#34;</span> | <span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>ToCSS</span> }}
</span></span><span style=display:flex><span>    &lt;<span style=color:#a6e22e>style</span>&gt;
</span></span><span style=display:flex><span>      {{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>css</span>.<span style=color:#a6e22e>Content</span> | <span style=color:#a6e22e>safeCSS</span> }}
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>/</span><span style=color:#a6e22e>style</span>&gt;
</span></span></code></pre></div><p>でてくる関数の詳細は <a href=https://gohugo.io/categories/asset-management>https://gohugo.io/categories/asset-management</a> を読んでください。SCSSを使うには extended と書いてあるバイナリを使う必要があるので注意です。生成されたファイルは <code>/resources/_gen/*</code> に作られるので <code>.gitignore</code> などに含めておくと良いでしょう</p><p>ちなみにSCSSはCSSと概ね互換性があるので、そのまま読めます。文法はここ　https://sass-lang.com/documentation/syntax より <a href=https://sass-lang.com/guide>https://sass-lang.com/guide</a> のほうが簡単にまとまってていいです。今回はとりあえず変数と演算を使ってページの幅とか調整しました。正直文法が気持ち悪いのであまり深追いしたくはないです。</p><h2 id=まとめ>まとめ</h2><p>気が変わっていにしえのHTML/CSS直書き原理主義にもどるかもしれませんが、いまのところMarkdown -> HTML と SCSS -> CSSと変換できるHugoに満足です。</p>Copyright © klknn All Rights Reserved.</body></html>